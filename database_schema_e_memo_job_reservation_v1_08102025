--
-- PostgreSQL database dump
--

\restrict ZUHB7uTNdt1s9ejEJiQOESVL20500TQk2eEmVsSX1gu3rg8thfyo8hUgaDmM8aW

-- Dumped from database version 17.6
-- Dumped by pg_dump version 17.6

-- Started on 2025-10-08 08:27:45

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 293 (class 1255 OID 58413)
-- Name: ticket_description_tsv_trigger(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.ticket_description_tsv_trigger() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
begin
  -- Pastikan kolom 'description' dan 'description_tsv' dieja dengan benar
  new.description_tsv := to_tsvector('simple', new.description);
  return new;
end
$$;


ALTER FUNCTION public.ticket_description_tsv_trigger() OWNER TO postgres;

--
-- TOC entry 292 (class 1255 OID 16385)
-- Name: trigger_set_timestamp(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.trigger_set_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;$$;


ALTER FUNCTION public.trigger_set_timestamp() OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 229 (class 1259 OID 16426)
-- Name: access_permission; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.access_permission (
    id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.access_permission OWNER TO postgres;

--
-- TOC entry 258 (class 1259 OID 19803)
-- Name: action; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.action (
    id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    hex_code text
);


ALTER TABLE public.action OWNER TO postgres;

--
-- TOC entry 257 (class 1259 OID 19802)
-- Name: action_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.action_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.action_id_seq OWNER TO postgres;

--
-- TOC entry 3790 (class 0 OID 0)
-- Dependencies: 257
-- Name: action_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.action_id_seq OWNED BY public.action.id;


--
-- TOC entry 275 (class 1259 OID 27633)
-- Name: actor_role; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.actor_role (
    id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.actor_role OWNER TO postgres;

--
-- TOC entry 274 (class 1259 OID 27632)
-- Name: actor_role_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.actor_role_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.actor_role_id_seq OWNER TO postgres;

--
-- TOC entry 3791 (class 0 OID 0)
-- Dependencies: 274
-- Name: actor_role_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.actor_role_id_seq OWNED BY public.actor_role.id;


--
-- TOC entry 273 (class 1259 OID 27613)
-- Name: actor_role_mapping; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.actor_role_mapping (
    id smallint NOT NULL,
    employee_position_id smallint NOT NULL,
    context text NOT NULL,
    actor_role_id smallint NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.actor_role_mapping OWNER TO postgres;

--
-- TOC entry 272 (class 1259 OID 27612)
-- Name: actor_role_mapping_actor_role_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.actor_role_mapping_actor_role_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.actor_role_mapping_actor_role_id_seq OWNER TO postgres;

--
-- TOC entry 3792 (class 0 OID 0)
-- Dependencies: 272
-- Name: actor_role_mapping_actor_role_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.actor_role_mapping_actor_role_id_seq OWNED BY public.actor_role_mapping.actor_role_id;


--
-- TOC entry 271 (class 1259 OID 27611)
-- Name: actor_role_mapping_employee_position_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.actor_role_mapping_employee_position_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.actor_role_mapping_employee_position_id_seq OWNER TO postgres;

--
-- TOC entry 3793 (class 0 OID 0)
-- Dependencies: 271
-- Name: actor_role_mapping_employee_position_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.actor_role_mapping_employee_position_id_seq OWNED BY public.actor_role_mapping.employee_position_id;


--
-- TOC entry 270 (class 1259 OID 27610)
-- Name: actor_role_mapping_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.actor_role_mapping_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.actor_role_mapping_id_seq OWNER TO postgres;

--
-- TOC entry 3794 (class 0 OID 0)
-- Dependencies: 270
-- Name: actor_role_mapping_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.actor_role_mapping_id_seq OWNED BY public.actor_role_mapping.id;


--
-- TOC entry 282 (class 1259 OID 35804)
-- Name: app_user; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.app_user (
    id bigint NOT NULL,
    username text NOT NULL,
    password text NOT NULL,
    employee_position_id smallint NOT NULL,
    employee_npk text,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    user_type text NOT NULL
);


ALTER TABLE public.app_user OWNER TO postgres;

--
-- TOC entry 217 (class 1259 OID 16386)
-- Name: area; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.area (
    id smallint NOT NULL,
    department_id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.area OWNER TO postgres;

--
-- TOC entry 218 (class 1259 OID 16394)
-- Name: area_department_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.area_department_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.area_department_id_seq OWNER TO postgres;

--
-- TOC entry 3795 (class 0 OID 0)
-- Dependencies: 218
-- Name: area_department_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.area_department_id_seq OWNED BY public.area.department_id;


--
-- TOC entry 219 (class 1259 OID 16395)
-- Name: area_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.area_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.area_id_seq OWNER TO postgres;

--
-- TOC entry 3796 (class 0 OID 0)
-- Dependencies: 219
-- Name: area_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.area_id_seq OWNED BY public.area.id;


--
-- TOC entry 220 (class 1259 OID 16396)
-- Name: department; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.department (
    id smallint NOT NULL,
    name text NOT NULL,
    receive_job boolean DEFAULT false NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.department OWNER TO postgres;

--
-- TOC entry 221 (class 1259 OID 16405)
-- Name: department_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.department_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.department_id_seq OWNER TO postgres;

--
-- TOC entry 3797 (class 0 OID 0)
-- Dependencies: 221
-- Name: department_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.department_id_seq OWNED BY public.department.id;


--
-- TOC entry 222 (class 1259 OID 16406)
-- Name: employee; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.employee (
    npk text NOT NULL,
    department_id smallint NOT NULL,
    area_id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    employee_position_id smallint NOT NULL
);


ALTER TABLE public.employee OWNER TO postgres;

--
-- TOC entry 223 (class 1259 OID 16414)
-- Name: employee_area_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.employee_area_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.employee_area_id_seq OWNER TO postgres;

--
-- TOC entry 3798 (class 0 OID 0)
-- Dependencies: 223
-- Name: employee_area_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.employee_area_id_seq OWNED BY public.employee.area_id;


--
-- TOC entry 224 (class 1259 OID 16415)
-- Name: employee_department_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.employee_department_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.employee_department_id_seq OWNER TO postgres;

--
-- TOC entry 3799 (class 0 OID 0)
-- Dependencies: 224
-- Name: employee_department_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.employee_department_id_seq OWNED BY public.employee.department_id;


--
-- TOC entry 233 (class 1259 OID 16444)
-- Name: employee_position; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.employee_position (
    id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.employee_position OWNER TO postgres;

--
-- TOC entry 225 (class 1259 OID 16416)
-- Name: employee_position_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.employee_position_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.employee_position_id_seq OWNER TO postgres;

--
-- TOC entry 3800 (class 0 OID 0)
-- Dependencies: 225
-- Name: employee_position_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.employee_position_id_seq OWNED BY public.employee.employee_position_id;


--
-- TOC entry 226 (class 1259 OID 16417)
-- Name: job; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.job (
    id bigint NOT NULL,
    ticket_id bigint NOT NULL,
    pic_job text,
    job_priority bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    version integer DEFAULT 1 NOT NULL,
    report_file jsonb,
    spending_amount bigint
);


ALTER TABLE public.job OWNER TO postgres;

--
-- TOC entry 227 (class 1259 OID 16424)
-- Name: job_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.job_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.job_id_seq OWNER TO postgres;

--
-- TOC entry 3801 (class 0 OID 0)
-- Dependencies: 227
-- Name: job_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.job_id_seq OWNED BY public.job.id;


--
-- TOC entry 228 (class 1259 OID 16425)
-- Name: job_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.job_ticket_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.job_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3802 (class 0 OID 0)
-- Dependencies: 228
-- Name: job_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.job_ticket_id_seq OWNED BY public.job.ticket_id;


--
-- TOC entry 230 (class 1259 OID 16434)
-- Name: permission_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.permission_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.permission_id_seq OWNER TO postgres;

--
-- TOC entry 3803 (class 0 OID 0)
-- Dependencies: 230
-- Name: permission_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.permission_id_seq OWNED BY public.access_permission.id;


--
-- TOC entry 231 (class 1259 OID 16435)
-- Name: physical_location; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.physical_location (
    id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.physical_location OWNER TO postgres;

--
-- TOC entry 232 (class 1259 OID 16443)
-- Name: physical_location_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.physical_location_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.physical_location_id_seq OWNER TO postgres;

--
-- TOC entry 3804 (class 0 OID 0)
-- Dependencies: 232
-- Name: physical_location_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.physical_location_id_seq OWNED BY public.physical_location.id;


--
-- TOC entry 234 (class 1259 OID 16452)
-- Name: position_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.position_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.position_id_seq OWNER TO postgres;

--
-- TOC entry 3805 (class 0 OID 0)
-- Dependencies: 234
-- Name: position_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.position_id_seq OWNED BY public.employee_position.id;


--
-- TOC entry 235 (class 1259 OID 16453)
-- Name: position_permission; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.position_permission (
    employee_position_id smallint NOT NULL,
    access_permission_id smallint NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.position_permission OWNER TO postgres;

--
-- TOC entry 236 (class 1259 OID 16459)
-- Name: position_permission_permission_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.position_permission_permission_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.position_permission_permission_id_seq OWNER TO postgres;

--
-- TOC entry 3806 (class 0 OID 0)
-- Dependencies: 236
-- Name: position_permission_permission_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.position_permission_permission_id_seq OWNED BY public.position_permission.access_permission_id;


--
-- TOC entry 237 (class 1259 OID 16460)
-- Name: position_permission_position_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.position_permission_position_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.position_permission_position_id_seq OWNER TO postgres;

--
-- TOC entry 3807 (class 0 OID 0)
-- Dependencies: 237
-- Name: position_permission_position_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.position_permission_position_id_seq OWNED BY public.position_permission.employee_position_id;


--
-- TOC entry 291 (class 1259 OID 44038)
-- Name: position_to_workflow_mapping; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.position_to_workflow_mapping (
    employee_position_id smallint NOT NULL,
    workflow_id smallint NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.position_to_workflow_mapping OWNER TO postgres;

--
-- TOC entry 289 (class 1259 OID 44036)
-- Name: position_to_workflow_mapping_employee_position_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.position_to_workflow_mapping_employee_position_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.position_to_workflow_mapping_employee_position_id_seq OWNER TO postgres;

--
-- TOC entry 3808 (class 0 OID 0)
-- Dependencies: 289
-- Name: position_to_workflow_mapping_employee_position_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.position_to_workflow_mapping_employee_position_id_seq OWNED BY public.position_to_workflow_mapping.employee_position_id;


--
-- TOC entry 290 (class 1259 OID 44037)
-- Name: position_to_workflow_mapping_workflow_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.position_to_workflow_mapping_workflow_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.position_to_workflow_mapping_workflow_id_seq OWNER TO postgres;

--
-- TOC entry 3809 (class 0 OID 0)
-- Dependencies: 290
-- Name: position_to_workflow_mapping_workflow_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.position_to_workflow_mapping_workflow_id_seq OWNED BY public.position_to_workflow_mapping.workflow_id;


--
-- TOC entry 238 (class 1259 OID 16480)
-- Name: section_status_ticket; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.section_status_ticket (
    id smallint NOT NULL,
    name text NOT NULL,
    sequence smallint NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.section_status_ticket OWNER TO postgres;

--
-- TOC entry 239 (class 1259 OID 16488)
-- Name: section_status_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.section_status_ticket_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.section_status_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3810 (class 0 OID 0)
-- Dependencies: 239
-- Name: section_status_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.section_status_ticket_id_seq OWNED BY public.section_status_ticket.id;


--
-- TOC entry 240 (class 1259 OID 16489)
-- Name: specified_location; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.specified_location (
    id smallint NOT NULL,
    physical_location_id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.specified_location OWNER TO postgres;

--
-- TOC entry 241 (class 1259 OID 16497)
-- Name: specified_location_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.specified_location_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.specified_location_id_seq OWNER TO postgres;

--
-- TOC entry 3811 (class 0 OID 0)
-- Dependencies: 241
-- Name: specified_location_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.specified_location_id_seq OWNED BY public.specified_location.id;


--
-- TOC entry 242 (class 1259 OID 16498)
-- Name: specified_location_physical_location_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.specified_location_physical_location_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.specified_location_physical_location_id_seq OWNER TO postgres;

--
-- TOC entry 3812 (class 0 OID 0)
-- Dependencies: 242
-- Name: specified_location_physical_location_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.specified_location_physical_location_id_seq OWNED BY public.specified_location.physical_location_id;


--
-- TOC entry 243 (class 1259 OID 16499)
-- Name: status_ticket; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.status_ticket (
    id smallint NOT NULL,
    name text NOT NULL,
    sequence smallint NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    section_id smallint NOT NULL,
    hex_color text
);


ALTER TABLE public.status_ticket OWNER TO postgres;

--
-- TOC entry 244 (class 1259 OID 16507)
-- Name: status_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.status_ticket_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.status_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3813 (class 0 OID 0)
-- Dependencies: 244
-- Name: status_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.status_ticket_id_seq OWNED BY public.status_ticket.id;


--
-- TOC entry 245 (class 1259 OID 16508)
-- Name: status_ticket_section_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.status_ticket_section_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.status_ticket_section_id_seq OWNER TO postgres;

--
-- TOC entry 3814 (class 0 OID 0)
-- Dependencies: 245
-- Name: status_ticket_section_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.status_ticket_section_id_seq OWNED BY public.status_ticket.section_id;


--
-- TOC entry 263 (class 1259 OID 19822)
-- Name: status_transition; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.status_transition (
    id smallint NOT NULL,
    from_status_id smallint,
    to_status_id smallint NOT NULL,
    action_id smallint NOT NULL,
    require_reason boolean DEFAULT false NOT NULL,
    reason_label text,
    require_file boolean DEFAULT false NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    actor_role_id smallint NOT NULL
);


ALTER TABLE public.status_transition OWNER TO postgres;

--
-- TOC entry 262 (class 1259 OID 19820)
-- Name: status_transition_action_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.status_transition_action_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.status_transition_action_id_seq OWNER TO postgres;

--
-- TOC entry 3815 (class 0 OID 0)
-- Dependencies: 262
-- Name: status_transition_action_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.status_transition_action_id_seq OWNED BY public.status_transition.action_id;


--
-- TOC entry 276 (class 1259 OID 27702)
-- Name: status_transition_actor_role_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.status_transition_actor_role_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.status_transition_actor_role_id_seq OWNER TO postgres;

--
-- TOC entry 3816 (class 0 OID 0)
-- Dependencies: 276
-- Name: status_transition_actor_role_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.status_transition_actor_role_id_seq OWNED BY public.status_transition.actor_role_id;


--
-- TOC entry 260 (class 1259 OID 19818)
-- Name: status_transition_from_status_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.status_transition_from_status_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.status_transition_from_status_id_seq OWNER TO postgres;

--
-- TOC entry 3817 (class 0 OID 0)
-- Dependencies: 260
-- Name: status_transition_from_status_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.status_transition_from_status_id_seq OWNED BY public.status_transition.from_status_id;


--
-- TOC entry 259 (class 1259 OID 19817)
-- Name: status_transition_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.status_transition_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.status_transition_id_seq OWNER TO postgres;

--
-- TOC entry 3818 (class 0 OID 0)
-- Dependencies: 259
-- Name: status_transition_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.status_transition_id_seq OWNED BY public.status_transition.id;


--
-- TOC entry 261 (class 1259 OID 19819)
-- Name: status_transition_to_status_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.status_transition_to_status_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.status_transition_to_status_id_seq OWNER TO postgres;

--
-- TOC entry 3819 (class 0 OID 0)
-- Dependencies: 261
-- Name: status_transition_to_status_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.status_transition_to_status_id_seq OWNED BY public.status_transition.to_status_id;


--
-- TOC entry 246 (class 1259 OID 16509)
-- Name: ticket; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.ticket (
    id bigint NOT NULL,
    requestor text NOT NULL,
    department_target_id smallint NOT NULL,
    physical_location_id smallint,
    specified_location_id smallint,
    description text NOT NULL,
    ticket_priority bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    version integer DEFAULT 1 NOT NULL,
    deadline timestamp with time zone,
    description_tsv tsvector,
    support_file jsonb
);


ALTER TABLE public.ticket OWNER TO postgres;

--
-- TOC entry 269 (class 1259 OID 19867)
-- Name: ticket_action_log; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.ticket_action_log (
    id bigint NOT NULL,
    ticket_id bigint NOT NULL,
    action_id smallint NOT NULL,
    performed_by_npk text NOT NULL,
    details_text text,
    file_path text[],
    from_status_id smallint NOT NULL,
    to_status_id smallint NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.ticket_action_log OWNER TO postgres;

--
-- TOC entry 266 (class 1259 OID 19864)
-- Name: ticket_action_log_action_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_action_log_action_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_action_log_action_id_seq OWNER TO postgres;

--
-- TOC entry 3820 (class 0 OID 0)
-- Dependencies: 266
-- Name: ticket_action_log_action_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_action_log_action_id_seq OWNED BY public.ticket_action_log.action_id;


--
-- TOC entry 267 (class 1259 OID 19865)
-- Name: ticket_action_log_from_status_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_action_log_from_status_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_action_log_from_status_id_seq OWNER TO postgres;

--
-- TOC entry 3821 (class 0 OID 0)
-- Dependencies: 267
-- Name: ticket_action_log_from_status_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_action_log_from_status_id_seq OWNED BY public.ticket_action_log.from_status_id;


--
-- TOC entry 264 (class 1259 OID 19862)
-- Name: ticket_action_log_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_action_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_action_log_id_seq OWNER TO postgres;

--
-- TOC entry 3822 (class 0 OID 0)
-- Dependencies: 264
-- Name: ticket_action_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_action_log_id_seq OWNED BY public.ticket_action_log.id;


--
-- TOC entry 265 (class 1259 OID 19863)
-- Name: ticket_action_log_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_action_log_ticket_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_action_log_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3823 (class 0 OID 0)
-- Dependencies: 265
-- Name: ticket_action_log_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_action_log_ticket_id_seq OWNED BY public.ticket_action_log.ticket_id;


--
-- TOC entry 268 (class 1259 OID 19866)
-- Name: ticket_action_log_to_status_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_action_log_to_status_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_action_log_to_status_id_seq OWNER TO postgres;

--
-- TOC entry 3824 (class 0 OID 0)
-- Dependencies: 268
-- Name: ticket_action_log_to_status_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_action_log_to_status_id_seq OWNED BY public.ticket_action_log.to_status_id;


--
-- TOC entry 247 (class 1259 OID 16516)
-- Name: ticket_department_target_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_department_target_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_department_target_id_seq OWNER TO postgres;

--
-- TOC entry 3825 (class 0 OID 0)
-- Dependencies: 247
-- Name: ticket_department_target_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_department_target_id_seq OWNED BY public.ticket.department_target_id;


--
-- TOC entry 248 (class 1259 OID 16517)
-- Name: ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3826 (class 0 OID 0)
-- Dependencies: 248
-- Name: ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_id_seq OWNED BY public.ticket.id;


--
-- TOC entry 249 (class 1259 OID 16518)
-- Name: ticket_physical_location_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_physical_location_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_physical_location_id_seq OWNER TO postgres;

--
-- TOC entry 3827 (class 0 OID 0)
-- Dependencies: 249
-- Name: ticket_physical_location_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_physical_location_id_seq OWNED BY public.ticket.physical_location_id;


--
-- TOC entry 250 (class 1259 OID 16519)
-- Name: ticket_specified_location_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_specified_location_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_specified_location_id_seq OWNER TO postgres;

--
-- TOC entry 3828 (class 0 OID 0)
-- Dependencies: 250
-- Name: ticket_specified_location_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_specified_location_id_seq OWNED BY public.ticket.specified_location_id;


--
-- TOC entry 251 (class 1259 OID 16520)
-- Name: track_status_ticket; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.track_status_ticket (
    id bigint NOT NULL,
    ticket_id bigint NOT NULL,
    status_ticket_id smallint NOT NULL,
    start_date timestamp with time zone DEFAULT now() NOT NULL,
    finish_date timestamp with time zone
);


ALTER TABLE public.track_status_ticket OWNER TO postgres;

--
-- TOC entry 252 (class 1259 OID 16524)
-- Name: track_status_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.track_status_ticket_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.track_status_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3829 (class 0 OID 0)
-- Dependencies: 252
-- Name: track_status_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.track_status_ticket_id_seq OWNED BY public.track_status_ticket.id;


--
-- TOC entry 253 (class 1259 OID 16525)
-- Name: track_status_ticket_status_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.track_status_ticket_status_ticket_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.track_status_ticket_status_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3830 (class 0 OID 0)
-- Dependencies: 253
-- Name: track_status_ticket_status_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.track_status_ticket_status_ticket_id_seq OWNED BY public.track_status_ticket.status_ticket_id;


--
-- TOC entry 254 (class 1259 OID 16526)
-- Name: track_status_ticket_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.track_status_ticket_ticket_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.track_status_ticket_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3831 (class 0 OID 0)
-- Dependencies: 254
-- Name: track_status_ticket_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.track_status_ticket_ticket_id_seq OWNED BY public.track_status_ticket.ticket_id;


--
-- TOC entry 279 (class 1259 OID 27718)
-- Name: transition_prerequisite; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.transition_prerequisite (
    transition_id smallint NOT NULL,
    required_status_id smallint NOT NULL,
    is_active boolean DEFAULT false NOT NULL
);


ALTER TABLE public.transition_prerequisite OWNER TO postgres;

--
-- TOC entry 278 (class 1259 OID 27717)
-- Name: transition_prerequisite_required_status_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.transition_prerequisite_required_status_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.transition_prerequisite_required_status_id_seq OWNER TO postgres;

--
-- TOC entry 3832 (class 0 OID 0)
-- Dependencies: 278
-- Name: transition_prerequisite_required_status_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.transition_prerequisite_required_status_id_seq OWNED BY public.transition_prerequisite.required_status_id;


--
-- TOC entry 277 (class 1259 OID 27716)
-- Name: transition_prerequisite_transition_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.transition_prerequisite_transition_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.transition_prerequisite_transition_id_seq OWNER TO postgres;

--
-- TOC entry 3833 (class 0 OID 0)
-- Dependencies: 277
-- Name: transition_prerequisite_transition_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.transition_prerequisite_transition_id_seq OWNED BY public.transition_prerequisite.transition_id;


--
-- TOC entry 280 (class 1259 OID 35802)
-- Name: user_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.user_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.user_id_seq OWNER TO postgres;

--
-- TOC entry 3834 (class 0 OID 0)
-- Dependencies: 280
-- Name: user_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.user_id_seq OWNED BY public.app_user.id;


--
-- TOC entry 281 (class 1259 OID 35803)
-- Name: user_user_position_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.user_user_position_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.user_user_position_seq OWNER TO postgres;

--
-- TOC entry 3835 (class 0 OID 0)
-- Dependencies: 281
-- Name: user_user_position_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.user_user_position_seq OWNED BY public.app_user.employee_position_id;


--
-- TOC entry 255 (class 1259 OID 16527)
-- Name: view_calculation_ticket_each_status; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.view_calculation_ticket_each_status AS
 WITH ticket_cohorts AS (
         SELECT tst.ticket_id,
            min(tst.start_date) AS cohort_date
           FROM (public.track_status_ticket tst
             JOIN public.status_ticket st ON ((tst.status_ticket_id = st.id)))
          WHERE (st.sequence >= 0)
          GROUP BY tst.ticket_id
        ), ranked_ticket_statuses AS (
         SELECT tst.ticket_id,
            tst.status_ticket_id,
            row_number() OVER (PARTITION BY tst.ticket_id ORDER BY tst.start_date DESC, tst.id DESC) AS rank_num
           FROM public.track_status_ticket tst
          WHERE (tst.ticket_id IN ( SELECT ticket_cohorts.ticket_id
                   FROM ticket_cohorts))
        ), current_ticket_status AS (
         SELECT tc.ticket_id,
            tc.cohort_date,
            st.name AS current_status_name
           FROM ((ticket_cohorts tc
             JOIN ranked_ticket_statuses rts ON (((tc.ticket_id = rts.ticket_id) AND (rts.rank_num = 1))))
             JOIN public.status_ticket st ON ((rts.status_ticket_id = st.id)))
        ), distinct_periods AS (
         SELECT DISTINCT (EXTRACT(year FROM ticket_cohorts.cohort_date))::integer AS year,
            (EXTRACT(month FROM ticket_cohorts.cohort_date))::integer AS month
           FROM ticket_cohorts
        ), relevant_statuses AS (
         SELECT status_ticket.name
           FROM public.status_ticket
          WHERE ((status_ticket.sequence >= 0) OR (status_ticket.sequence = '-100'::integer))
        )
 SELECT dp.year,
    dp.month,
    rs.name AS status,
    COALESCE(count(cts.ticket_id), (0)::bigint) AS total
   FROM ((distinct_periods dp
     CROSS JOIN relevant_statuses rs)
     LEFT JOIN current_ticket_status cts ON ((((dp.year)::numeric = EXTRACT(year FROM cts.cohort_date)) AND ((dp.month)::numeric = EXTRACT(month FROM cts.cohort_date)) AND (rs.name = cts.current_status_name))))
  GROUP BY dp.year, dp.month, rs.name
  ORDER BY dp.year, dp.month, ( SELECT status_ticket.sequence
           FROM public.status_ticket
          WHERE (status_ticket.name = rs.name));


ALTER VIEW public.view_calculation_ticket_each_status OWNER TO postgres;

--
-- TOC entry 256 (class 1259 OID 16532)
-- Name: view_ticket_list; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.view_ticket_list AS
 WITH ticket_actual_start AS (
         SELECT tst.ticket_id,
            min(tst.start_date) AS actual_start_date
           FROM ((public.track_status_ticket tst
             JOIN public.status_ticket st ON ((tst.status_ticket_id = st.id)))
             JOIN public.section_status_ticket sst ON ((st.section_id = sst.id)))
          WHERE (sst.name = 'Actual Section'::text)
          GROUP BY tst.ticket_id
        )
 SELECT t.id AS ticket_id,
    t.description,
    t.department_target_id,
    t.ticket_priority,
    j.job_priority,
        CASE
            WHEN (tas.actual_start_date IS NOT NULL) THEN ((now())::date - (tas.actual_start_date)::date)
            ELSE NULL::integer
        END AS ticket_age_days,
    req_emp.name AS requestor_name,
    req_dept.name AS requestor_department,
    ( SELECT st.name
           FROM (public.track_status_ticket tst
             JOIN public.status_ticket st ON ((tst.status_ticket_id = st.id)))
          WHERE (tst.ticket_id = t.id)
          ORDER BY tst.start_date DESC, tst.id DESC
         LIMIT 1) AS current_status,
    pic_emp.name AS pic_name,
    pic_area.name AS pic_area_name,
    phys_loc.name AS location_name,
    spec_loc.name AS specified_location_name
   FROM ((((((((public.ticket t
     LEFT JOIN public.job j ON ((t.id = j.ticket_id)))
     LEFT JOIN ticket_actual_start tas ON ((t.id = tas.ticket_id)))
     JOIN public.employee req_emp ON ((t.requestor = req_emp.npk)))
     LEFT JOIN public.department req_dept ON ((req_emp.department_id = req_dept.id)))
     LEFT JOIN public.employee pic_emp ON ((j.pic_job = pic_emp.npk)))
     LEFT JOIN public.area pic_area ON ((pic_emp.area_id = pic_area.id)))
     LEFT JOIN public.physical_location phys_loc ON ((t.physical_location_id = phys_loc.id)))
     LEFT JOIN public.specified_location spec_loc ON ((t.specified_location_id = spec_loc.id)));


ALTER VIEW public.view_ticket_list OWNER TO postgres;

--
-- TOC entry 284 (class 1259 OID 43995)
-- Name: workflow; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.workflow (
    id smallint NOT NULL,
    name text NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.workflow OWNER TO postgres;

--
-- TOC entry 283 (class 1259 OID 43994)
-- Name: workflow_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.workflow_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.workflow_id_seq OWNER TO postgres;

--
-- TOC entry 3836 (class 0 OID 0)
-- Dependencies: 283
-- Name: workflow_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.workflow_id_seq OWNED BY public.workflow.id;


--
-- TOC entry 288 (class 1259 OID 44012)
-- Name: workflow_step; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.workflow_step (
    id smallint NOT NULL,
    workflow_id smallint NOT NULL,
    status_ticket_id smallint NOT NULL,
    step_sequence smallint NOT NULL,
    is_active boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.workflow_step OWNER TO postgres;

--
-- TOC entry 285 (class 1259 OID 44009)
-- Name: workflow_step_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.workflow_step_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.workflow_step_id_seq OWNER TO postgres;

--
-- TOC entry 3837 (class 0 OID 0)
-- Dependencies: 285
-- Name: workflow_step_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.workflow_step_id_seq OWNED BY public.workflow_step.id;


--
-- TOC entry 287 (class 1259 OID 44011)
-- Name: workflow_step_status_ticket_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.workflow_step_status_ticket_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.workflow_step_status_ticket_id_seq OWNER TO postgres;

--
-- TOC entry 3838 (class 0 OID 0)
-- Dependencies: 287
-- Name: workflow_step_status_ticket_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.workflow_step_status_ticket_id_seq OWNED BY public.workflow_step.status_ticket_id;


--
-- TOC entry 286 (class 1259 OID 44010)
-- Name: workflow_step_workflow_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.workflow_step_workflow_id_seq
    AS smallint
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.workflow_step_workflow_id_seq OWNER TO postgres;

--
-- TOC entry 3839 (class 0 OID 0)
-- Dependencies: 286
-- Name: workflow_step_workflow_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.workflow_step_workflow_id_seq OWNED BY public.workflow_step.workflow_id;


--
-- TOC entry 3434 (class 2604 OID 16558)
-- Name: access_permission id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.access_permission ALTER COLUMN id SET DEFAULT nextval('public.permission_id_seq'::regclass);


--
-- TOC entry 3467 (class 2604 OID 19806)
-- Name: action id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.action ALTER COLUMN id SET DEFAULT nextval('public.action_id_seq'::regclass);


--
-- TOC entry 3482 (class 2604 OID 27636)
-- Name: actor_role id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role ALTER COLUMN id SET DEFAULT nextval('public.actor_role_id_seq'::regclass);


--
-- TOC entry 3479 (class 2604 OID 27616)
-- Name: actor_role_mapping id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role_mapping ALTER COLUMN id SET DEFAULT nextval('public.actor_role_mapping_id_seq'::regclass);


--
-- TOC entry 3487 (class 2604 OID 35807)
-- Name: app_user id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.app_user ALTER COLUMN id SET DEFAULT nextval('public.user_id_seq'::regclass);


--
-- TOC entry 3418 (class 2604 OID 16555)
-- Name: area id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.area ALTER COLUMN id SET DEFAULT nextval('public.area_id_seq'::regclass);


--
-- TOC entry 3422 (class 2604 OID 16556)
-- Name: department id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.department ALTER COLUMN id SET DEFAULT nextval('public.department_id_seq'::regclass);


--
-- TOC entry 3442 (class 2604 OID 16560)
-- Name: employee_position id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.employee_position ALTER COLUMN id SET DEFAULT nextval('public.position_id_seq'::regclass);


--
-- TOC entry 3430 (class 2604 OID 16557)
-- Name: job id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.job ALTER COLUMN id SET DEFAULT nextval('public.job_id_seq'::regclass);


--
-- TOC entry 3438 (class 2604 OID 16559)
-- Name: physical_location id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.physical_location ALTER COLUMN id SET DEFAULT nextval('public.physical_location_id_seq'::regclass);


--
-- TOC entry 3449 (class 2604 OID 16563)
-- Name: section_status_ticket id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.section_status_ticket ALTER COLUMN id SET DEFAULT nextval('public.section_status_ticket_id_seq'::regclass);


--
-- TOC entry 3453 (class 2604 OID 16564)
-- Name: specified_location id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.specified_location ALTER COLUMN id SET DEFAULT nextval('public.specified_location_id_seq'::regclass);


--
-- TOC entry 3457 (class 2604 OID 16565)
-- Name: status_ticket id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_ticket ALTER COLUMN id SET DEFAULT nextval('public.status_ticket_id_seq'::regclass);


--
-- TOC entry 3471 (class 2604 OID 19825)
-- Name: status_transition id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_transition ALTER COLUMN id SET DEFAULT nextval('public.status_transition_id_seq'::regclass);


--
-- TOC entry 3461 (class 2604 OID 16566)
-- Name: ticket id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket ALTER COLUMN id SET DEFAULT nextval('public.ticket_id_seq'::regclass);


--
-- TOC entry 3477 (class 2604 OID 19870)
-- Name: ticket_action_log id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_action_log ALTER COLUMN id SET DEFAULT nextval('public.ticket_action_log_id_seq'::regclass);


--
-- TOC entry 3465 (class 2604 OID 16567)
-- Name: track_status_ticket id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.track_status_ticket ALTER COLUMN id SET DEFAULT nextval('public.track_status_ticket_id_seq'::regclass);


--
-- TOC entry 3491 (class 2604 OID 43998)
-- Name: workflow id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow ALTER COLUMN id SET DEFAULT nextval('public.workflow_id_seq'::regclass);


--
-- TOC entry 3495 (class 2604 OID 44015)
-- Name: workflow_step id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow_step ALTER COLUMN id SET DEFAULT nextval('public.workflow_step_id_seq'::regclass);


--
-- TOC entry 3550 (class 2606 OID 19813)
-- Name: action action_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.action
    ADD CONSTRAINT action_pkey PRIMARY KEY (id);


--
-- TOC entry 3552 (class 2606 OID 19815)
-- Name: action action_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.action
    ADD CONSTRAINT action_unique UNIQUE (name);


--
-- TOC entry 3558 (class 2606 OID 27624)
-- Name: actor_role_mapping actor_role_mapping_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role_mapping
    ADD CONSTRAINT actor_role_mapping_pkey PRIMARY KEY (id);


--
-- TOC entry 3560 (class 2606 OID 27626)
-- Name: actor_role_mapping actor_role_mapping_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role_mapping
    ADD CONSTRAINT actor_role_mapping_unique UNIQUE (employee_position_id, context);


--
-- TOC entry 3562 (class 2606 OID 27643)
-- Name: actor_role actor_role_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role
    ADD CONSTRAINT actor_role_pkey PRIMARY KEY (id);


--
-- TOC entry 3564 (class 2606 OID 27645)
-- Name: actor_role actor_role_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role
    ADD CONSTRAINT actor_role_unique UNIQUE (name);


--
-- TOC entry 3503 (class 2606 OID 16571)
-- Name: area area_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.area
    ADD CONSTRAINT area_pkey PRIMARY KEY (id);


--
-- TOC entry 3505 (class 2606 OID 16573)
-- Name: area area_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.area
    ADD CONSTRAINT area_unique UNIQUE (name, department_id);


--
-- TOC entry 3507 (class 2606 OID 16575)
-- Name: department department_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.department
    ADD CONSTRAINT department_pkey PRIMARY KEY (id);


--
-- TOC entry 3509 (class 2606 OID 16577)
-- Name: department department_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.department
    ADD CONSTRAINT department_unique UNIQUE (name);


--
-- TOC entry 3511 (class 2606 OID 16579)
-- Name: employee employee_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.employee
    ADD CONSTRAINT employee_pkey PRIMARY KEY (npk);


--
-- TOC entry 3513 (class 2606 OID 16581)
-- Name: job job_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.job
    ADD CONSTRAINT job_pkey PRIMARY KEY (id);


--
-- TOC entry 3515 (class 2606 OID 16585)
-- Name: access_permission permission_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.access_permission
    ADD CONSTRAINT permission_pkey PRIMARY KEY (id);


--
-- TOC entry 3517 (class 2606 OID 16587)
-- Name: access_permission permission_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.access_permission
    ADD CONSTRAINT permission_unique UNIQUE (name);


--
-- TOC entry 3519 (class 2606 OID 16589)
-- Name: physical_location physical_location_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.physical_location
    ADD CONSTRAINT physical_location_pkey PRIMARY KEY (id);


--
-- TOC entry 3521 (class 2606 OID 16591)
-- Name: physical_location physical_location_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.physical_location
    ADD CONSTRAINT physical_location_unique UNIQUE (name);


--
-- TOC entry 3527 (class 2606 OID 16593)
-- Name: position_permission position_permission_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.position_permission
    ADD CONSTRAINT position_permission_pkey PRIMARY KEY (employee_position_id, access_permission_id);


--
-- TOC entry 3523 (class 2606 OID 16595)
-- Name: employee_position position_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.employee_position
    ADD CONSTRAINT position_pkey PRIMARY KEY (id);


--
-- TOC entry 3580 (class 2606 OID 44047)
-- Name: position_to_workflow_mapping position_to_workflow_mapping_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.position_to_workflow_mapping
    ADD CONSTRAINT position_to_workflow_mapping_pkey PRIMARY KEY (employee_position_id, workflow_id);


--
-- TOC entry 3582 (class 2606 OID 47397)
-- Name: position_to_workflow_mapping position_to_workflow_mapping_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.position_to_workflow_mapping
    ADD CONSTRAINT position_to_workflow_mapping_unique UNIQUE (employee_position_id);


--
-- TOC entry 3525 (class 2606 OID 16601)
-- Name: employee_position position_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.employee_position
    ADD CONSTRAINT position_unique UNIQUE (name);


--
-- TOC entry 3529 (class 2606 OID 16605)
-- Name: section_status_ticket section_status_ticket_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.section_status_ticket
    ADD CONSTRAINT section_status_ticket_pkey PRIMARY KEY (id);


--
-- TOC entry 3531 (class 2606 OID 16607)
-- Name: section_status_ticket section_status_ticket_unique_name; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.section_status_ticket
    ADD CONSTRAINT section_status_ticket_unique_name UNIQUE (name);


--
-- TOC entry 3533 (class 2606 OID 16609)
-- Name: section_status_ticket section_status_ticket_unique_sequence; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.section_status_ticket
    ADD CONSTRAINT section_status_ticket_unique_sequence UNIQUE (sequence);


--
-- TOC entry 3535 (class 2606 OID 16611)
-- Name: specified_location specified_location_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.specified_location
    ADD CONSTRAINT specified_location_pkey PRIMARY KEY (id);


--
-- TOC entry 3537 (class 2606 OID 16613)
-- Name: specified_location specified_location_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.specified_location
    ADD CONSTRAINT specified_location_unique UNIQUE (physical_location_id, name);


--
-- TOC entry 3539 (class 2606 OID 16615)
-- Name: status_ticket status_ticket_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_ticket
    ADD CONSTRAINT status_ticket_pkey PRIMARY KEY (id);


--
-- TOC entry 3541 (class 2606 OID 16617)
-- Name: status_ticket status_ticket_unique_name; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_ticket
    ADD CONSTRAINT status_ticket_unique_name UNIQUE (name);


--
-- TOC entry 3543 (class 2606 OID 16619)
-- Name: status_ticket status_ticket_unique_sequence; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_ticket
    ADD CONSTRAINT status_ticket_unique_sequence UNIQUE (sequence);


--
-- TOC entry 3554 (class 2606 OID 19838)
-- Name: status_transition status_transition_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_transition
    ADD CONSTRAINT status_transition_pkey PRIMARY KEY (id);


--
-- TOC entry 3556 (class 2606 OID 19879)
-- Name: ticket_action_log ticket_action_log_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_action_log
    ADD CONSTRAINT ticket_action_log_pkey PRIMARY KEY (id);


--
-- TOC entry 3546 (class 2606 OID 16621)
-- Name: ticket ticket_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT ticket_pkey PRIMARY KEY (id);


--
-- TOC entry 3548 (class 2606 OID 16625)
-- Name: track_status_ticket track_status_ticket_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.track_status_ticket
    ADD CONSTRAINT track_status_ticket_pkey PRIMARY KEY (id);


--
-- TOC entry 3566 (class 2606 OID 27725)
-- Name: transition_prerequisite transition_prerequisite_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.transition_prerequisite
    ADD CONSTRAINT transition_prerequisite_pkey PRIMARY KEY (transition_id);


--
-- TOC entry 3568 (class 2606 OID 35815)
-- Name: app_user user_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.app_user
    ADD CONSTRAINT user_pkey PRIMARY KEY (id);


--
-- TOC entry 3570 (class 2606 OID 35817)
-- Name: app_user user_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.app_user
    ADD CONSTRAINT user_unique UNIQUE (username);


--
-- TOC entry 3572 (class 2606 OID 44005)
-- Name: workflow workflow_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow
    ADD CONSTRAINT workflow_pkey PRIMARY KEY (id);


--
-- TOC entry 3576 (class 2606 OID 44022)
-- Name: workflow_step workflow_step_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow_step
    ADD CONSTRAINT workflow_step_pkey PRIMARY KEY (id);


--
-- TOC entry 3578 (class 2606 OID 44024)
-- Name: workflow_step workflow_step_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow_step
    ADD CONSTRAINT workflow_step_unique UNIQUE (workflow_id, step_sequence);


--
-- TOC entry 3574 (class 2606 OID 44007)
-- Name: workflow workflow_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow
    ADD CONSTRAINT workflow_unique UNIQUE (name);


--
-- TOC entry 3544 (class 1259 OID 58412)
-- Name: ticket_description_tsv_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX ticket_description_tsv_idx ON public.ticket USING gin (description_tsv);


--
-- TOC entry 3631 (class 2620 OID 19816)
-- Name: action action_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER action_set_timestamp BEFORE UPDATE ON public.action FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3633 (class 2620 OID 27652)
-- Name: actor_role_mapping actor_role_mapping_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER actor_role_mapping_set_timestamp BEFORE UPDATE ON public.actor_role_mapping FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3634 (class 2620 OID 27646)
-- Name: actor_role actor_role_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER actor_role_set_timestamp BEFORE UPDATE ON public.actor_role FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3618 (class 2620 OID 16636)
-- Name: area area_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER area_set_timestamp BEFORE UPDATE ON public.area FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3619 (class 2620 OID 16637)
-- Name: department department_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER department_set_timestamp BEFORE UPDATE ON public.department FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3620 (class 2620 OID 16638)
-- Name: employee employee; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER employee BEFORE UPDATE ON public.employee FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3621 (class 2620 OID 16639)
-- Name: job job_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER job_set_timestamp BEFORE UPDATE ON public.job FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3622 (class 2620 OID 16640)
-- Name: access_permission permission_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER permission_set_timestamp BEFORE UPDATE ON public.access_permission FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3623 (class 2620 OID 16641)
-- Name: physical_location physical_location_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER physical_location_set_timestamp BEFORE UPDATE ON public.physical_location FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3625 (class 2620 OID 16642)
-- Name: position_permission position_permission_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER position_permission_set_timestamp BEFORE UPDATE ON public.position_permission FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3624 (class 2620 OID 16643)
-- Name: employee_position position_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER position_set_timestamp BEFORE UPDATE ON public.employee_position FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3637 (class 2620 OID 44058)
-- Name: position_to_workflow_mapping position_to_workflow_mapping_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER position_to_workflow_mapping_set_timestamp BEFORE UPDATE ON public.position_to_workflow_mapping FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3626 (class 2620 OID 16646)
-- Name: section_status_ticket section_status_ticket_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER section_status_ticket_set_timestamp BEFORE UPDATE ON public.section_status_ticket FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3627 (class 2620 OID 16647)
-- Name: specified_location specified_location_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER specified_location_set_timestamp BEFORE UPDATE ON public.specified_location FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3628 (class 2620 OID 16648)
-- Name: status_ticket status_ticket_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER status_ticket_set_timestamp BEFORE UPDATE ON public.status_ticket FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3632 (class 2620 OID 19861)
-- Name: status_transition status_transition_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER status_transition_set_timestamp BEFORE UPDATE ON public.status_transition FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3629 (class 2620 OID 16649)
-- Name: ticket ticket_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER ticket_set_timestamp BEFORE UPDATE ON public.ticket FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3630 (class 2620 OID 68320)
-- Name: ticket tsvectorupdate; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER tsvectorupdate BEFORE INSERT ON public.ticket FOR EACH ROW EXECUTE FUNCTION public.ticket_description_tsv_trigger();


--
-- TOC entry 3635 (class 2620 OID 44008)
-- Name: workflow workflow_set_timestamp; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER workflow_set_timestamp BEFORE UPDATE ON public.workflow FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3636 (class 2620 OID 44035)
-- Name: workflow_step workflow_step; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER workflow_step BEFORE UPDATE ON public.workflow_step FOR EACH ROW EXECUTE FUNCTION public.trigger_set_timestamp();


--
-- TOC entry 3599 (class 2606 OID 19851)
-- Name: status_transition action_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_transition
    ADD CONSTRAINT action_id FOREIGN KEY (action_id) REFERENCES public.action(id) ON DELETE CASCADE;


--
-- TOC entry 3603 (class 2606 OID 19885)
-- Name: ticket_action_log action_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_action_log
    ADD CONSTRAINT action_id FOREIGN KEY (action_id) REFERENCES public.action(id);


--
-- TOC entry 3608 (class 2606 OID 27647)
-- Name: actor_role_mapping actor_role_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role_mapping
    ADD CONSTRAINT actor_role_id FOREIGN KEY (actor_role_id) REFERENCES public.actor_role(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3600 (class 2606 OID 27711)
-- Name: status_transition actor_role_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_transition
    ADD CONSTRAINT actor_role_id FOREIGN KEY (actor_role_id) REFERENCES public.actor_role(id) NOT VALID;


--
-- TOC entry 3584 (class 2606 OID 16652)
-- Name: employee area_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.employee
    ADD CONSTRAINT area_id FOREIGN KEY (area_id) REFERENCES public.area(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3583 (class 2606 OID 16657)
-- Name: area department_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.area
    ADD CONSTRAINT department_id FOREIGN KEY (department_id) REFERENCES public.department(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3585 (class 2606 OID 16662)
-- Name: employee department_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.employee
    ADD CONSTRAINT department_id FOREIGN KEY (department_id) REFERENCES public.department(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3593 (class 2606 OID 27653)
-- Name: ticket department_target_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT department_target_id FOREIGN KEY (department_target_id) REFERENCES public.department(id) NOT VALID;


--
-- TOC entry 3612 (class 2606 OID 35823)
-- Name: app_user employee_npk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.app_user
    ADD CONSTRAINT employee_npk FOREIGN KEY (employee_npk) REFERENCES public.employee(npk);


--
-- TOC entry 3609 (class 2606 OID 27627)
-- Name: actor_role_mapping employee_position_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.actor_role_mapping
    ADD CONSTRAINT employee_position_id FOREIGN KEY (employee_position_id) REFERENCES public.employee_position(id) ON DELETE CASCADE;


--
-- TOC entry 3616 (class 2606 OID 44048)
-- Name: position_to_workflow_mapping employee_position_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.position_to_workflow_mapping
    ADD CONSTRAINT employee_position_id FOREIGN KEY (employee_position_id) REFERENCES public.employee_position(id);


--
-- TOC entry 3601 (class 2606 OID 19841)
-- Name: status_transition from_status_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_transition
    ADD CONSTRAINT from_status_id FOREIGN KEY (from_status_id) REFERENCES public.status_ticket(id) ON DELETE CASCADE;


--
-- TOC entry 3604 (class 2606 OID 19895)
-- Name: ticket_action_log from_status_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_action_log
    ADD CONSTRAINT from_status_id FOREIGN KEY (from_status_id) REFERENCES public.status_ticket(id);


--
-- TOC entry 3605 (class 2606 OID 19890)
-- Name: ticket_action_log performed_by_npk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_action_log
    ADD CONSTRAINT performed_by_npk FOREIGN KEY (performed_by_npk) REFERENCES public.employee(npk);


--
-- TOC entry 3589 (class 2606 OID 16672)
-- Name: position_permission permission_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.position_permission
    ADD CONSTRAINT permission_id FOREIGN KEY (access_permission_id) REFERENCES public.access_permission(id) ON DELETE CASCADE;


--
-- TOC entry 3591 (class 2606 OID 16677)
-- Name: specified_location physical_location_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.specified_location
    ADD CONSTRAINT physical_location_id FOREIGN KEY (physical_location_id) REFERENCES public.physical_location(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3594 (class 2606 OID 27658)
-- Name: ticket physical_location_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT physical_location_id FOREIGN KEY (physical_location_id) REFERENCES public.physical_location(id) NOT VALID;


--
-- TOC entry 3587 (class 2606 OID 16687)
-- Name: job pic_job; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.job
    ADD CONSTRAINT pic_job FOREIGN KEY (pic_job) REFERENCES public.employee(npk) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3586 (class 2606 OID 16692)
-- Name: employee position_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.employee
    ADD CONSTRAINT position_id FOREIGN KEY (employee_position_id) REFERENCES public.employee_position(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3590 (class 2606 OID 16702)
-- Name: position_permission postion_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.position_permission
    ADD CONSTRAINT postion_id FOREIGN KEY (employee_position_id) REFERENCES public.employee_position(id) ON DELETE CASCADE;


--
-- TOC entry 3595 (class 2606 OID 27668)
-- Name: ticket requestor; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT requestor FOREIGN KEY (requestor) REFERENCES public.employee(npk) NOT VALID;


--
-- TOC entry 3610 (class 2606 OID 27731)
-- Name: transition_prerequisite required_status_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.transition_prerequisite
    ADD CONSTRAINT required_status_id FOREIGN KEY (required_status_id) REFERENCES public.status_ticket(id);


--
-- TOC entry 3592 (class 2606 OID 16717)
-- Name: status_ticket section_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_ticket
    ADD CONSTRAINT section_id FOREIGN KEY (section_id) REFERENCES public.section_status_ticket(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3596 (class 2606 OID 27663)
-- Name: ticket specified_location_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT specified_location_id FOREIGN KEY (specified_location_id) REFERENCES public.specified_location(id) NOT VALID;


--
-- TOC entry 3597 (class 2606 OID 16727)
-- Name: track_status_ticket status_ticket_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.track_status_ticket
    ADD CONSTRAINT status_ticket_id FOREIGN KEY (status_ticket_id) REFERENCES public.status_ticket(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3614 (class 2606 OID 44030)
-- Name: workflow_step status_ticket_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow_step
    ADD CONSTRAINT status_ticket_id FOREIGN KEY (status_ticket_id) REFERENCES public.status_ticket(id);


--
-- TOC entry 3588 (class 2606 OID 16737)
-- Name: job ticket_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.job
    ADD CONSTRAINT ticket_id FOREIGN KEY (ticket_id) REFERENCES public.ticket(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3598 (class 2606 OID 16747)
-- Name: track_status_ticket ticket_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.track_status_ticket
    ADD CONSTRAINT ticket_id FOREIGN KEY (ticket_id) REFERENCES public.ticket(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 3606 (class 2606 OID 19880)
-- Name: ticket_action_log ticket_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_action_log
    ADD CONSTRAINT ticket_id FOREIGN KEY (ticket_id) REFERENCES public.ticket(id) ON DELETE CASCADE;


--
-- TOC entry 3602 (class 2606 OID 19846)
-- Name: status_transition to_status_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.status_transition
    ADD CONSTRAINT to_status_id FOREIGN KEY (to_status_id) REFERENCES public.status_ticket(id) ON DELETE CASCADE;


--
-- TOC entry 3607 (class 2606 OID 19900)
-- Name: ticket_action_log to_status_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_action_log
    ADD CONSTRAINT to_status_id FOREIGN KEY (to_status_id) REFERENCES public.status_ticket(id);


--
-- TOC entry 3611 (class 2606 OID 27726)
-- Name: transition_prerequisite transition_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.transition_prerequisite
    ADD CONSTRAINT transition_id FOREIGN KEY (transition_id) REFERENCES public.status_transition(id);


--
-- TOC entry 3613 (class 2606 OID 35818)
-- Name: app_user user_position; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.app_user
    ADD CONSTRAINT user_position FOREIGN KEY (employee_position_id) REFERENCES public.employee_position(id);


--
-- TOC entry 3615 (class 2606 OID 44025)
-- Name: workflow_step workflow_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.workflow_step
    ADD CONSTRAINT workflow_id FOREIGN KEY (workflow_id) REFERENCES public.workflow(id);


--
-- TOC entry 3617 (class 2606 OID 44053)
-- Name: position_to_workflow_mapping workflow_id; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.position_to_workflow_mapping
    ADD CONSTRAINT workflow_id FOREIGN KEY (workflow_id) REFERENCES public.workflow(id);


-- Completed on 2025-10-08 08:27:45

--
-- PostgreSQL database dump complete
--

\unrestrict ZUHB7uTNdt1s9ejEJiQOESVL20500TQk2eEmVsSX1gu3rg8thfyo8hUgaDmM8aW

